{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 500,
  "height": 500,
  "title": "Natural Disaster Risk Index by Country",
  "projection": {"type": "mercator", "center": [120, 3.5], "scale": 230},
  "data": {
    "url": "https://raw.githubusercontent.com/ZhuYaci/FIT3179DV2/main/data/ne_50m_admin_0_map_units.json",
    "format": {"type": "topojson", "feature": "ne_50m_admin_0_map_units"}
  },
  "transform": [
    {
      "lookup": "properties.ISO_A3",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/ZhuYaci/FIT3179DV2/main/data/risk_index_cleaned.csv",
          "format": {"type": "csv"}
        },
        "key": "ISO_A3",
        "fields": ["Risk_Index"]
      }
    },
    {"calculate": "toNumber(datum.Risk_Index)", "as": "Risk_Index_num"},
    {
      "lookup": "properties.ISO_A3",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/ZhuYaci/FIT3179DV2/main/data/vulnerability_cleaned.csv",
          "format": {"type": "csv"}
        },
        "key": "ISO_A3",
        "fields": ["Vulnerability_Index", "Year"],
        "values": ["Vulnerability_Index_2022", "Year_2022"]
      },
      "as": ["Vulnerability_Index_2022", "Year_2022"],
      "default": null
    },
    {
      "lookup": "properties.ISO_A3",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/ZhuYaci/FIT3179DV2/main/data/vulnerability_cleaned.csv",
          "format": {"type": "csv"}
        },
        "key": "ISO_A3",
        "fields": ["Vulnerability_Index", "Year"],
        "values": ["Vulnerability_Index_2021", "Year_2021"]
      },
      "as": ["Vulnerability_Index_2021", "Year_2021"],
      "default": null
    },
    {
      "calculate": "datum.Vulnerability_Index_2022 > datum.Vulnerability_Index_2021 ? 'Increase' : datum.Vulnerability_Index_2022 < datum.Vulnerability_Index_2021 ? 'Decrease' : 'No Change'",
      "as": "Change_from_2021"
    }
  ],
  "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.5},
  "encoding": {
    "color": {
      "field": "Risk_Index_num",
      "type": "quantitative",
      "title": "Risk Index",
      "scale": {"scheme": "oranges"}
    },
    "tooltip": [
      {"field": "properties.NAME", "type": "nominal", "title": "Country"},
      {
        "field": "Risk_Index_num",
        "type": "quantitative",
        "title": "Risk Index"
      },
      {
        "field": "Vulnerability_Index_2022",
        "type": "quantitative",
        "title": "Vulnerability (2022)[lower is better]"
      },
      {
        "field": "Change_from_2021",
        "type": "nominal",
        "title": "Change from 2021"
      }
    ]
  },
  "config": {}
}